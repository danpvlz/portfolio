---
import { Image } from "astro:assets";
import myImage from "../assets/daniela.png";
import { routes } from "./routes";
import MenuMobile from "./MenuMobile";
---

<header
  transition:persist
  class={`transition-all duration-300 w-full flex justify-between max-w-7xl px-7 static mt-5 md:mt-0 md:fixed z-50 bg-black bg-opacity-70 md:backdrop-blur-xl rounded-full top-2 `}
>
  <a href="/" class="flex items-center justify-center align-middle gap-3">
    <Image
      src={myImage}
      alt="Daniela Paiva"
      class="rounded-full border-2 border-slate-400"
      width="35"
      height="35"
    />
    <p class="font-normal">Daniela Paiva</p>
  </a>
  <MenuMobile client:only />
  <nav class="hidden md:block">
    <ul class="flex flex-col md:flex-row gap-2 relative">
      {
        routes.map((route) => (
          <li class="py-4 px-4 relative">
            <a
              href={route.link}
              class={
                "opacity-60 font-normal transition-all duration-300 after:transition-all after:duration-300 hover:text-primary hover:opacity-100 after:absolute after:inset-0 after:border-b-2 after:border-primary after:m-auto after:w-1 after:opacity-0 hover:after:opacity-100 hover:after:w-full hover:after:visible after:invisible"
              }
            >
              {route.name}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</header>
<script>
  const selectRoute = (route: string) => {
    const allMenus = document.querySelectorAll(`nav a`);
    allMenus.forEach((m) => {
      if (m?.getAttribute("href") === route) {
        m.classList.remove("opacity-60");
        m.classList.add("opacity-100");
        return;
      }
      m.classList.add("opacity-60");
    });
  };

  (function () {
    selectRoute(window.location.pathname + window.location.hash);
  })();

  const loadObservers = () => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        const intersecting = entry.isIntersecting;
        if (intersecting) {
          selectRoute(entry.target.id === "home" ? '/' : `#${entry.target.id}`);
        }
      });
    },  { threshold: [0.25] });
    const sections = document.querySelectorAll("section");
    sections.forEach((section) => observer.observe(section));
  };

  document.addEventListener("astro:page-load", loadObservers);
</script>
